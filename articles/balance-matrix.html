<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Balancing a matrix • cuadramelo</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../lightswitch.js"></script><script src="../katex-auto.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><link href="../deps/KaTex-0.16.10/katex.min.css" rel="stylesheet">
<script src="../deps/KaTex-0.16.10/katex.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Balancing a matrix">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">cuadramelo</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/balance-matrix.html">Balancing a matrix</a></li>
    <li><a class="dropdown-item" href="../articles/round-matrix.html">Rounding a matrix</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Balancing a matrix</h1>
            
      

      <div class="d-none name"><code>balance-matrix.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="balancing-matrices">Balancing matrices<a class="anchor" aria-label="anchor" href="#balancing-matrices"></a>
</h2>
<p>This section is concerned with the problem of slightly adjusting a
matrix so that its row and column totals add up to given vector using
<code><a href="../reference/balance_matrix.html">balance_matrix()</a></code>.</p>
<blockquote>
<p><strong>Remark:</strong> In order for the adjustment to be possible,
the sum of those two vectors must be the same. This only makes sense,
because both must equal the sum of the whole resulting matrix.</p>
</blockquote>
<div class="section level3">
<h3 id="balancing-a-simple-matrix">Balancing a simple matrix<a class="anchor" aria-label="anchor" href="#balancing-a-simple-matrix"></a>
</h3>
<p>Consider the example matrix</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">example_matrix</span></span>
<span><span class="co">#&gt;        [,1]   [,2]   [,3]   [,4]   [,5]</span></span>
<span><span class="co">#&gt; [1,] -0.897 -1.130  0.708 -0.139 -0.393</span></span>
<span><span class="co">#&gt; [2,]  0.185 -0.080 -0.240  0.418 -1.040</span></span>
<span><span class="co">#&gt; [3,]  1.588  0.132  1.984  0.982  1.782</span></span></code></pre></div>
<p>and the desired row totals</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">row_totals</span></span>
<span><span class="co">#&gt; [1] -1.851  0.243  6.468</span></span></code></pre></div>
<p>and column totals,</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">col_totals</span></span>
<span><span class="co">#&gt; [1]  0.87 -1.07  3.45  0.26  1.35</span></span></code></pre></div>
<p>which are mildly different from those of the matrix.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">example_matrix</span><span class="op">)</span> <span class="op">-</span> <span class="va">col_totals</span></span>
<span><span class="co">#&gt; [1]  0.006 -0.008 -0.998  1.001 -1.001</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">example_matrix</span><span class="op">)</span> <span class="op">-</span> <span class="va">row_totals</span></span>
<span><span class="co">#&gt; [1]  0 -1  0</span></span></code></pre></div>
<p>Let’s use our function to solve this problem.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tallied_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/balance_matrix.html">balance_matrix</a></span><span class="op">(</span><span class="va">example_matrix</span>, <span class="va">col_totals</span>, <span class="va">row_totals</span><span class="op">)</span></span>
<span><span class="va">tallied_matrix</span> <span class="op">-</span> <span class="va">example_matrix</span></span>
<span><span class="co">#&gt;             [,1]   [,2]  [,3]       [,4]  [,5]</span></span>
<span><span class="co">#&gt; [1,] -0.06866667 -0.064 0.266 -0.4003333 0.267</span></span>
<span><span class="co">#&gt; [2,]  0.13133333  0.136 0.466 -0.2003333 0.467</span></span>
<span><span class="co">#&gt; [3,] -0.06866667 -0.064 0.266 -0.4003333 0.267</span></span>
<span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">tallied_matrix</span><span class="op">)</span> <span class="op">-</span> <span class="va">row_totals</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">7</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0 0 0</span></span>
<span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">tallied_matrix</span><span class="op">)</span> <span class="op">-</span> <span class="va">col_totals</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">7</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0 0 0 0 0</span></span></code></pre></div>
<p>We don’t need to provide both the row and column totals. If only the
column totals (or rows) are provided, the tallying is done to match only
those.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tallied_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/balance_matrix.html">balance_matrix</a></span><span class="op">(</span><span class="va">example_matrix</span>, <span class="va">col_totals</span><span class="op">)</span></span>
<span><span class="va">tallied_matrix</span> <span class="op">-</span> <span class="va">example_matrix</span></span>
<span><span class="co">#&gt;        [,1]       [,2]      [,3]       [,4]      [,5]</span></span>
<span><span class="co">#&gt; [1,] -0.002 0.00266667 0.3326667 -0.3336667 0.3336667</span></span>
<span><span class="co">#&gt; [2,] -0.002 0.00266667 0.3326667 -0.3336667 0.3336667</span></span>
<span><span class="co">#&gt; [3,] -0.002 0.00266667 0.3326667 -0.3336667 0.3336667</span></span>
<span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">tallied_matrix</span><span class="op">)</span> <span class="op">-</span> <span class="va">row_totals</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">7</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1]  0.3333333 -0.6666667  0.3333333</span></span>
<span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">tallied_matrix</span><span class="op">)</span> <span class="op">-</span> <span class="va">col_totals</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">7</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0 0 0 0 0</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="balancing-a-matrix-by-blocks">Balancing a matrix by blocks<a class="anchor" aria-label="anchor" href="#balancing-a-matrix-by-blocks"></a>
</h3>
<p>Sometimes one may need to balance a matrix that is made up of blocks.
For example, suppose that the following <span class="math inline">16\times4</span> matrix is composed of 4 vertical
<span class="math inline">4\times 2</span> blocks.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">block_matrix</span></span>
<span><span class="co">#&gt;          [,1]    [,2]</span></span>
<span><span class="co">#&gt;  [1,]   0.187  -9.549</span></span>
<span><span class="co">#&gt;  [2,]  -1.843  -1.952</span></span>
<span><span class="co">#&gt;  [3,] -13.713   9.255</span></span>
<span><span class="co">#&gt;  [4,]  -5.992   4.830</span></span>
<span><span class="co">#&gt;  [5,]   2.945  -5.963</span></span>
<span><span class="co">#&gt;  [6,]   3.898 -21.853</span></span>
<span><span class="co">#&gt;  [7,] -12.081  -6.749</span></span>
<span><span class="co">#&gt;  [8,]  -3.637 -21.191</span></span>
<span><span class="co">#&gt;  [9,] -16.267 -12.652</span></span>
<span><span class="co">#&gt; [10,]  -2.565  -3.737</span></span>
<span><span class="co">#&gt; [11,]  11.018  -6.876</span></span>
<span><span class="co">#&gt; [12,]   7.558  -8.722</span></span>
<span><span class="co">#&gt; [13,]  -2.382  -1.018</span></span>
<span><span class="co">#&gt; [14,]   9.874  -2.538</span></span>
<span><span class="co">#&gt; [15,]   7.414 -18.537</span></span>
<span><span class="co">#&gt; [16,]   0.893  -0.779</span></span></code></pre></div>
<p>And we have the following matrix whose rows are the desired column
totals for each of the blocks.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">block_col_totals</span></span>
<span><span class="co">#&gt;      [,1] [,2]</span></span>
<span><span class="co">#&gt; [1,]  -21    3</span></span>
<span><span class="co">#&gt; [2,]   -9  -56</span></span>
<span><span class="co">#&gt; [3,]    0  -32</span></span>
<span><span class="co">#&gt; [4,]   16  -23</span></span></code></pre></div>
<p>The <code><a href="../reference/balance_by_blocks.html">balance_by_blocks()</a></code> function applies
<code><a href="../reference/balance_matrix.html">balance_matrix()</a></code> to each block using the totals given by
the argument <code>col_totals</code>. When the blocks are distributed
vertically (<code>layout = 2</code>), this argument must be a matrix as
wide as the matrix to be balanced (<code>Y</code>), and with a row for
each block. We have to indicate also that the bloks are 4 rows long
(<code>L = 4</code>). Blocks are assumed to be as wide as the matrix (or
as tall as the matrix if distributed horizontally).</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/balance_by_blocks.html">balance_by_blocks</a></span><span class="op">(</span><span class="va">block_matrix</span>, col_totals <span class="op">=</span> <span class="va">block_col_totals</span>, </span>
<span>                       layout <span class="op">=</span> <span class="fl">2</span>, L <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">X</span><span class="op">[</span><span class="fl">9</span><span class="op">:</span><span class="fl">12</span>,<span class="op">]</span> <span class="op">-</span> <span class="fu"><a href="../reference/balance_matrix.html">balance_matrix</a></span><span class="op">(</span><span class="va">block_matrix</span><span class="op">[</span><span class="fl">9</span><span class="op">:</span><span class="fl">12</span>,<span class="op">]</span>, <span class="va">block_col_totals</span><span class="op">[</span><span class="fl">3</span>,<span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;      [,1] [,2]</span></span>
<span><span class="co">#&gt; [1,]    0    0</span></span>
<span><span class="co">#&gt; [2,]    0    0</span></span>
<span><span class="co">#&gt; [3,]    0    0</span></span>
<span><span class="co">#&gt; [4,]    0    0</span></span></code></pre></div>
<p>Just as with <code><a href="../reference/balance_matrix.html">balance_matrix()</a></code>, both
<code>col_totals</code> and <code>row_totals</code> can be provided. In
the case of vertically distributed blocks, <code>row_totals</code> is a
vector with an entry for each row of the <code>Y</code> matrix. The
function solves the problem independently for each block.</p>
<p>The blocks can be distributed horizontally and analogous
considerations apply.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Miguel Serrano.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
